# coffeescript-async-await

誰得な内容ですが、ひさびさに CoffeeScript で書かれたコードをメンテナンスしていて、そういえば async/await はどうするんだろうと思ったら、

`CoffeeScript2` から **async/await** がサポートされていたようです。

[CoffeeScript async-functions](https://coffeescript.org/#async-functions)

## CoffeeScript

ちょっとトラップなのが、 CoffeeScript 側には `async` は書かないです。

自動的にコンパイル時に付与されるようです。

むしろ書くと関数呼び出しだと勘違いして async() と関数呼び出しにコンパイルされるので、動かなくなります。

```coffeescript
timer = (value, delay) ->
  return new Promise (resolve, reject) ->
    setTimeout ( ->
      resolve(value)
      return
    ), delay

asyncFunc = ->
  console.log await timer(1, 0)
  console.log await timer(2, 100)
  console.log await timer(3, 1000)

asyncFunc()
```

## JavaScript

```javascript
// Generated by CoffeeScript 2.6.1
(function() {
  var asyncFunc, timer;

  timer = function(value, delay) {
    return new Promise(function(resolve, reject) {
      return setTimeout((function() {
        resolve(value);
      }), delay);
    });
  };

  asyncFunc = async function() {
    console.log((await timer(1, 0)));
    console.log((await timer(2, 100)));
    return console.log((await timer(3, 1000)));
  };

  asyncFunc();

}).call(this);
```

## Reference link

[CoffeeScriptからBabel(ES6)へ乗り換えは早とちり？CoffeeScript2の概要](https://kanasys.com/tech/649#index6)
